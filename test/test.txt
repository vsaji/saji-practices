#!/bin/bash

# Check if the file path is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <file_path>"
  exit 1
fi

FILE_PATH="$1"

# Check if the file exists
if [ ! -f "$FILE_PATH" ]; then
  echo "File not found: $FILE_PATH"
  exit 1
fi

# Create a backup of the original file
cp "$FILE_PATH" "$FILE_PATH.bak"

# Replace each placeholder with the value of the corresponding environment variable
# This preserves the formatting by processing each environment variable individually
for var in $(compgen -e); do
  value=$(printenv "$var")
  # Escape slashes in the value to prevent sed issues
  escaped_value=$(printf '%s\n' "$value" | sed 's/[&/\]/\\&/g')
  sed -i "s|\${$var}|$escaped_value|g; s|\$$var|$escaped_value|g" "$FILE_PATH"
done

echo "Environment variables have been replaced in $FILE_PATH (backup created as $FILE_PATH.bak)."
